/* https://github.com/summera/chromestore.js */
var ChromeStore=function(e){function r(e){var r="";switch(e.name){case"QuotaExceededError":r="QuotaExceededError";break;case"NotFoundError":r="NotFoundError";break;case"SecurityError":r="SecurityError";break;case"InvalidModificationError":r="InvalidModificationError";break;case"InvalidStateError":r="InvalidStateError";break;default:r="Unknown Error"}console.log("Error: "+r)}e="undefined"!=typeof e?e:[];var t=null;return{init:function(o,n){function i(e){for(var r in e)if(e.hasOwnProperty(r)){var t=e[r];t.path&&u.getDir(t.path,{create:!0},t.callback)}}function a(o){window.webkitRequestFileSystem(window.PERSISTENT,o,function(r){t=r,console.log("fs: ",arguments),console.log("Granted Bytes: "+o),console.log("**********************************"),i(e),n&&n(u)},r)}function c(e){navigator.webkitPersistentStorage.requestQuota(e,function(e){console.log("PERSISTENT STORAGE"),console.log("**********************************"),console.log("requestQuota: ",arguments),a(e,n)},r)}var u=this;c(o)},getDir:function(e,o,n){function i(e,n,a){e="object"==typeof e?e:e.split("/");var c=a?a:t.root;"."!=e[0]&&""!=e[0]||(e=e.slice(1)),c.getDirectory(e[0],o,function(r){e.length-1?i(e.slice(1),n,r):n&&n(r)},r)}i(e,n)},deleteDir:function(e,o,n){var o=o||{};void 0===o.recursive&&(o.recursive=!1);var i=t.root;i.getDirectory(e,{},function(e){o.recursive?e.removeRecursively(function(){n&&n()},r):e.remove(function(){n&&n()},r)},r)},renameDir:function(e,o,n){for(var i=t.root,a=e.split("/"),c=a.length,u="",l=0;c-2>=l;l++)u=u+a[l]+"/";i.getDirectory(u,{},function(e){u=e},r),i.getDirectory(e,{},function(t){t.moveTo(u,o,function(r){console.log(e+" Directory renamed."),n&&n(r)},r)},r)},getFile:function(e,o,n){t.root.getFile(e,o,function(e){n&&n(e)},r)},deleteFile:function(e){t.root.getFile(e,{create:!1},function(e){e.remove(function(){},r)},r)},renameFile:function(e,o,n){for(var i=t.root,a=e.split("/"),c=a.length,u="",l=0;c-2>=l;l++)u=u+a[l]+"/";i.getDirectory(u,{},function(e){u=e},r),t.root.getFile(e,{},function(e){e.moveTo(u,o,function(){console.log("File renamed"),n&&n(e)},r)},r)},usedAndRemaining:function(e){navigator.webkitPersistentStorage.queryUsageAndQuota(function(r,t){e&&e(r,t)})},createWriter:function(){var e=new FileWriter(t);return e},write:function(e,r,t,o,n){var i=this.createWriter();i.writeData(e,r,t,o,n)},createReceiver:function(){var e=new DataReceiver;return e},getData:function(e,r){var t=this.createReceiver();t.getData(e,r)},getAndWrite:function(e,r,t,o,n){var i=this;this.getData(e,function(e){i.write(r,t,e,o,n)})},purge:function(){var e=t.root.createReader();e.readEntries(function(e){for(var t,o=0;t=e[o];++o)t.isDirectory?t.removeRecursively(function(){},r):t.remove(function(){},r);console.log("Local storage emptied.")},r)},ls:function(e,o){for(var n,i=[],a=t.root,c=e.split("/"),u=c.length,l="",s=0;u-1>=s;s++)l=l+c[s]+"/";a.getDirectory(l,{},function(e){l=e,n=l?l.createReader():t.root.createReader(),n.readEntries(function(e){e.length||console.log("Filesystem is empty.");for(var r,t=0;r=e[t];++t)i.push({name:r.name,fileEntry:r.filesystem});o&&o(i)},r)},r)}}},FileWriter=function(e){function r(e){var r="";switch(e.name){case"QuotaExceededError":r="QuotaExceededError";break;case"NotFoundError":r="NotFoundError";break;case"SecurityError":r="SecurityError";break;case"InvalidModificationError":r="InvalidModificationError";break;case"InvalidStateError":r="InvalidStateError";break;default:r="Unknown Error"}console.log("Error: "+r)}var t=e;return{writeData:function(e,o,n,i,a){t.root.getFile(e,i,function(e){e.createWriter(function(r){r.onwriteend=function(){console.log("Write completed."),a&&a(e)},r.onerror=function(e){console.log("Write failed: "+e.toString())};var t=new Blob([n],{type:o});r.write(t)},r)},r)}}},DataReceiver=function(){return{getData:function(e,r){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.addEventListener("progress",function(e){var r=0;if(e.lengthComputable){var t=e.loaded/e.total;r=Math.round(100*t)}MusecOffline.showDownloadProgress("update",r)},!1),t.onload=function(){200==this.status&&r(this.response)},t.send()}}};